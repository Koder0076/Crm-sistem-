<!DOCTYPE html>
<html lang="uk">  
<head>  
<meta charset="UTF-8">  
<meta name="viewport" content="width=device-width, initial-scale=1.0">  
<title>Main Page</title>  
<style>  
* { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }  
body { background: #000; color: #fff; min-height: 100vh; padding-bottom: 70px; }  
.blur { filter: blur(8px); pointer-events: none; }  
.user-id { position: fixed; top: 6px; left: 8px; font-size: 11px; opacity: 0.6; z-index: 1001; }  
#app { min-height: 100vh; display: flex; flex-direction: column; align-items: center; }  
.score-label { margin-top: 20px; font-size: 22px; font-weight: 600; }  
.main { flex: 1; display: flex; align-items: center; justify-content: center; gap: 16px; width: 100%; }  
.side-img { width: 72px; height: 120px; overflow: hidden; border-radius: 10px; opacity: 0.85; }  
.side-img img { width: 100%; height: 100%; object-fit: cover; }  
.points { font-size: 76px; font-weight: 900; padding: 16px 32px; border-radius: 16px; background: linear-gradient(145deg, #0a0a0a, #151515); }  
.bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; height: 60px; background: #000; display: flex; justify-content: space-around; align-items: center; border-top: 1px solid #222; }  
.bottom-nav a { text-decoration: none; color: #fff; font-size: 15px; }  
.modal { position: fixed; inset: 0; background: rgba(0,0,0,0.85); display: flex; align-items: center; justify-content: center; z-index: 1000; }  
.form { background: #111; padding: 24px; border-radius: 12px; width: 280px; }  
.form input { width: 100%; padding: 10px; margin-bottom: 12px; background: #000; border: 1px solid #333; color: #fff; }  
.form button { width: 100%; padding: 10px; background: #00ff88; border: none; font-weight: bold; }  
</style>  
</head>  
<body>  

<div class="user-id" id="uid"></div>  

<!-- ===== APP ===== -->  
<div id="app">  
    <div class="score-label">Score</div>  
    <div class="main">  
        <div class="side-img"><img src="Yu.jpg"></div>  
        <div class="points" id="points">0</div>  
        <div class="side-img"><img src="Yu.jpg"></div>  
    </div>  
    <nav class="bottom-nav">  
        <a href="index21.html">üéÆ Game</a>  
        <a href="earn.html">üí∞ Earn</a>  
        <a href="listing.html">üìã Listing</a>  
    </nav>
</div>  

<!-- ===== MODAL ===== -->  
<div class="modal" id="modal">  
    <div class="form">  
        <input id="email" placeholder="Email">  
        <input id="user" placeholder="Username / Telegram">  
        <button onclick="register()">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è</button>  
    </div>  
</div>  

<script>  
const modal = document.getElementById("modal");  
const app = document.getElementById("app");  
const uidElem = document.getElementById("uid");  
const pointsElem = document.getElementById("points");  

const emailInput = document.getElementById("email");  
const userInput = document.getElementById("user");  

let uid = localStorage.getItem("uid");  

function loadScore(userId) {
    fetch(`/score/${userId}`)
        .then(res => res.json())
        .then(data => { pointsElem.textContent = data.score || 0; })
        .catch(err => console.error(err));
}

if (!uid) {  
    app.classList.add("blur");  
    modal.style.display = "flex";
} else {  
    uidElem.textContent = "ID: " + uid;  
    modal.style.display = "none";  
    app.classList.remove("blur");
    loadScore(uid);
}  

function register() {  
    const email = emailInput.value.trim();  
    const user = userInput.value.trim();  

    if (!email || !user) { alert("–ó–∞–ø–æ–≤–Ω–∏ –≤—Å—ñ –ø–æ–ª—è"); return; }  

    fetch("/register", {  
        method: "POST",  
        headers: { "Content-Type": "application/json" },  
        body: JSON.stringify({ email, user })  
    })  
    .then(res => res.json())  
    .then(data => {  
        if (data.ok) {  
            uid = data.id;
            localStorage.setItem("uid", uid);  
            localStorage.setItem("email", email);  

            uidElem.textContent = "ID: " + uid;  
            modal.style.display = "none";  
            app.classList.remove("blur");  

            loadScore(uid);
        } else if (data.error === "exists") {  
            alert("–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∂–µ —ñ—Å–Ω—É—î");  
        }  
    })  
    .catch(err => console.error(err));  
}  

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –æ—á–æ–∫ —ñ–∑ –≥—Ä–∏
function addScore(value) {
    if (!uid) return;
    fetch("/score", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ id: uid, score: value })
    })
    .then(() => loadScore(uid))
    .catch(err => console.error(err));
}
</script>  

</body>  
</html>